<template>
  <div class="dashboard">
    <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
    <n-grid :cols="4" :x-gap="16" :y-gap="16" class="stats-grid">
      <n-gi>
        <n-card class="stat-card card-1" hoverable>
          <div class="stat-content">
            <div class="stat-icon">
              <n-icon :component="DocumentTextOutline" size="40" />
            </div>
            <div class="stat-info">
              <div class="stat-label">æ–‡ç« æ€»æ•°</div>
              <div class="stat-value">{{ stats.articleCount }}</div>
              <div class="stat-trend">
                <n-icon :component="TrendingUpOutline" size="16" />
                <span>è¾ƒä¸Šæœˆ +12%</span>
              </div>
            </div>
          </div>
        </n-card>
      </n-gi>
      <n-gi>
        <n-card class="stat-card card-2" hoverable>
          <div class="stat-content">
            <div class="stat-icon">
              <n-icon :component="PeopleOutline" size="40" />
            </div>
            <div class="stat-info">
              <div class="stat-label">ç”¨æˆ·æ€»æ•°</div>
              <div class="stat-value">{{ stats.userCount }}</div>
              <div class="stat-trend">
                <n-icon :component="TrendingUpOutline" size="16" />
                <span>è¾ƒä¸Šæœˆ +8%</span>
              </div>
            </div>
          </div>
        </n-card>
      </n-gi>
      <n-gi>
        <n-card class="stat-card card-3" hoverable>
          <div class="stat-content">
            <div class="stat-icon">
              <n-icon :component="ChatbubblesOutline" size="40" />
            </div>
            <div class="stat-info">
              <div class="stat-label">è¯„è®ºæ€»æ•°</div>
              <div class="stat-value">{{ stats.commentCount }}</div>
              <div class="stat-trend">
                <n-icon :component="TrendingUpOutline" size="16" />
                <span>è¾ƒä¸Šæœˆ +15%</span>
              </div>
            </div>
          </div>
        </n-card>
      </n-gi>
      <n-gi>
        <n-card class="stat-card card-4" hoverable>
          <div class="stat-content">
            <div class="stat-icon">
              <n-icon :component="EyeOutline" size="40" />
            </div>
            <div class="stat-info">
              <div class="stat-label">æµè§ˆæ€»æ•°</div>
              <div class="stat-value">{{ stats.viewCount }}</div>
              <div class="stat-trend">
                <n-icon :component="TrendingUpOutline" size="16" />
                <span>è¾ƒä¸Šæœˆ +23%</span>
              </div>
            </div>
          </div>
        </n-card>
      </n-gi>
    </n-grid>

    <!-- å›¾è¡¨åŒºåŸŸ -->
    <n-grid :cols="2" :x-gap="16" :y-gap="16" style="margin-top: 16px">
      <n-gi>
        <n-card title="è®¿é—®è¶‹åŠ¿" class="chart-card" hoverable>
          <div ref="visitChartRef" style="width: 100%; height: 300px"></div>
        </n-card>
      </n-gi>
      <n-gi>
        <n-card title="æ–‡ç« åˆ†ç±»ç»Ÿè®¡" class="chart-card" hoverable>
          <div ref="categoryChartRef" style="width: 100%; height: 300px"></div>
        </n-card>
      </n-gi>
    </n-grid>

    <!-- æŠ€æœ¯æ ˆå’Œæ›´æ–°æ—¥å¿— -->
    <n-grid :cols="2" :x-gap="16" :y-gap="16" style="margin-top: 16px">
      <n-gi>
        <n-card title="æŠ€æœ¯æ ˆ" class="tech-card" hoverable>
          <template #header-extra>
            <n-tag type="success" size="small">v1.0.0</n-tag>
          </template>
          <n-space vertical :size="16">
            <div class="tech-section">
              <div class="tech-title">
                <n-icon :component="ServerOutline" color="#2ADB5C" />
                <span>åç«¯æŠ€æœ¯</span>
              </div>
              <n-space :size="8" class="tech-tags">
                <n-tag type="info">Spring Boot 4.0.0-M2</n-tag>
                <n-tag type="info">MyBatis-Plus 3.5.14</n-tag>
                <n-tag type="info">Sa-Token 1.39.0</n-tag>
                <n-tag type="info">MySQL</n-tag>
                <n-tag type="info">Redis</n-tag>
                <n-tag type="info">Druid</n-tag>
              </n-space>
            </div>
            <n-divider style="margin: 8px 0" />
            <div class="tech-section">
              <div class="tech-title">
                <n-icon :component="CodeSlashOutline" color="#2ADB5C" />
                <span>å‰ç«¯æŠ€æœ¯</span>
              </div>
              <n-space :size="8" class="tech-tags">
                <n-tag type="success">Vue 3.5</n-tag>
                <n-tag type="success">Vite 7.2</n-tag>
                <n-tag type="success">Naive UI 2.38</n-tag>
                <n-tag type="success">Pinia 2.1</n-tag>
                <n-tag type="success">Vue Router 4.2</n-tag>
                <n-tag type="success">Echarts 5.4</n-tag>
              </n-space>
            </div>
            <n-divider style="margin: 8px 0" />
            <div class="tech-section">
              <div class="tech-title">
                <n-icon :component="CloudUploadOutline" color="#2ADB5C" />
                <span>å­˜å‚¨æ–¹æ¡ˆ</span>
              </div>
              <n-space :size="8" class="tech-tags">
                <n-tag type="warning">MinIO</n-tag>
                <n-tag type="warning">é˜¿é‡Œäº‘OSS</n-tag>
              </n-space>
            </div>
          </n-space>
        </n-card>
      </n-gi>
      <n-gi>
        <n-card title="æ›´æ–°æ—¥å¿—" class="changelog-card" hoverable>
          <template #header-extra>
            <n-tag type="info" size="small">Latest</n-tag>
          </template>
          <n-timeline>
            <n-timeline-item
              type="success"
              title="v1.0.0"
              time="2025-11-27"
              :line-type="'dashed'"
            >
              <template #icon>
                <n-icon :component="CheckmarkCircleOutline" />
              </template>
              <ul class="changelog-list">
                <li>âœ¨ å®Œæˆåå°ç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–</li>
                <li>ğŸ¨ å®ç°é»‘è‰²ä¸»é¢˜ç™»å½•é¡µé¢</li>
                <li>ğŸ“ å®Œæˆæ–‡ç« ã€åˆ†ç±»ã€æ ‡ç­¾ç®¡ç†</li>
                <li>ğŸ–¼ï¸ é›†æˆMinIO/OSSæ–‡ä»¶ä¸Šä¼ </li>
                <li>ğŸ“Š æ·»åŠ æ•°æ®ç»Ÿè®¡å’Œå›¾è¡¨å±•ç¤º</li>
              </ul>
            </n-timeline-item>
            <n-timeline-item
              type="warning"
              title="v0.9.0"
              time="2025-11-20"
              :line-type="'dashed'"
            >
              <template #icon>
                <n-icon :component="BuildOutline" />
              </template>
              <ul class="changelog-list">
                <li>ğŸ”§ é¡¹ç›®æ¶æ„æ­å»º</li>
                <li>ğŸ” ç”¨æˆ·è®¤è¯ç³»ç»Ÿé›†æˆ</li>
                <li>ğŸ’¾ æ•°æ®åº“è®¾è®¡å®Œæˆ</li>
              </ul>
            </n-timeline-item>
            <n-timeline-item
              type="info"
              title="v0.5.0"
              time="2025-11-15"
            >
              <template #icon>
                <n-icon :component="RocketOutline" />
              </template>
              <ul class="changelog-list">
                <li>ğŸš€ é¡¹ç›®åˆå§‹åŒ–</li>
                <li>ğŸ“¦ æŠ€æœ¯æ ˆé€‰å‹</li>
              </ul>
            </n-timeline-item>
          </n-timeline>
        </n-card>
      </n-gi>
    </n-grid>

    <!-- ç³»ç»Ÿä¿¡æ¯ -->
    <n-card title="ç³»ç»Ÿä¿¡æ¯" class="system-card" style="margin-top: 16px" hoverable>
      <n-descriptions label-placement="left" :column="3" bordered>
        <n-descriptions-item label="å½“å‰ç”¨æˆ·">
          <n-tag type="success">
            <template #icon>
              <n-icon :component="PersonOutline" />
            </template>
            {{ userStore.userInfo.nickname || 'ç®¡ç†å‘˜' }}
          </n-tag>
        </n-descriptions-item>
        <n-descriptions-item label="ç™»å½•æ—¶é—´">
          {{ currentTime }}
        </n-descriptions-item>
        <n-descriptions-item label="ç³»ç»Ÿç‰ˆæœ¬">
          <n-tag type="info">v1.0.0</n-tag>
        </n-descriptions-item>
        <n-descriptions-item label="è¿è¡Œç¯å¢ƒ">
          Java 25 + Node.js
        </n-descriptions-item>
        <n-descriptions-item label="æ•°æ®åº“">
          MySQL 8.0 + Redis
        </n-descriptions-item>
        <n-descriptions-item label="ç³»ç»ŸçŠ¶æ€">
          <n-tag type="success">
            <template #icon>
              <n-icon :component="CheckmarkCircleOutline" />
            </template>
            è¿è¡Œæ­£å¸¸
          </n-tag>
        </n-descriptions-item>
      </n-descriptions>
    </n-card>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import * as echarts from 'echarts'
import {
  DocumentTextOutline,
  PeopleOutline,
  ChatbubblesOutline,
  EyeOutline,
  TrendingUpOutline,
  ServerOutline,
  CodeSlashOutline,
  CloudUploadOutline,
  CheckmarkCircleOutline,
  BuildOutline,
  RocketOutline,
  PersonOutline
} from '@vicons/ionicons5'
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

const visitChartRef = ref(null)
const categoryChartRef = ref(null)
let visitChart = null
let categoryChart = null

const stats = ref({
  articleCount: 156,
  userCount: 1234,
  commentCount: 589,
  viewCount: 12345
})

const currentTime = ref(new Date().toLocaleString('zh-CN'))

// åˆå§‹åŒ–è®¿é—®è¶‹åŠ¿å›¾è¡¨
const initVisitChart = () => {
  visitChart = echarts.init(visitChartRef.value)
  const option = {
    backgroundColor: 'transparent',
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'shadow'
      }
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      top: '10%',
      containLabel: true
    },
    xAxis: {
      type: 'category',
      data: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
      axisLine: {
        lineStyle: {
          color: '#e5e7eb'
        }
      },
      axisLabel: {
        color: '#6b7280'
      }
    },
    yAxis: {
      type: 'value',
      axisLine: {
        lineStyle: {
          color: '#e5e7eb'
        }
      },
      axisLabel: {
        color: '#6b7280'
      },
      splitLine: {
        lineStyle: {
          color: '#f3f4f6'
        }
      }
    },
    series: [
      {
        name: 'è®¿é—®é‡',
        type: 'bar',
        data: [320, 432, 301, 534, 590, 530, 620],
        itemStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: '#2ADB5C' },
            { offset: 1, color: '#18A058' }
          ]),
          borderRadius: [4, 4, 0, 0]
        },
        emphasis: {
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: '#36f567' },
              { offset: 1, color: '#2ADB5C' }
            ])
          }
        }
      }
    ]
  }
  visitChart.setOption(option)
}

// åˆå§‹åŒ–åˆ†ç±»ç»Ÿè®¡å›¾è¡¨
const initCategoryChart = () => {
  categoryChart = echarts.init(categoryChartRef.value)
  const option = {
    backgroundColor: 'transparent',
    tooltip: {
      trigger: 'item',
      formatter: '{a} <br/>{b}: {c} ({d}%)'
    },
    legend: {
      orient: 'vertical',
      right: '10%',
      top: 'center',
      textStyle: {
        color: '#6b7280'
      }
    },
    series: [
      {
        name: 'åˆ†ç±»ç»Ÿè®¡',
        type: 'pie',
        radius: ['40%', '70%'],
        center: ['35%', '50%'],
        avoidLabelOverlap: false,
        itemStyle: {
          borderRadius: 10,
          borderColor: '#ffffff',
          borderWidth: 2
        },
        label: {
          show: false,
          position: 'center'
        },
        emphasis: {
          label: {
            show: true,
            fontSize: 20,
            fontWeight: 'bold',
            color: '#2ADB5C'
          }
        },
        labelLine: {
          show: false
        },
        data: [
          { value: 45, name: 'Java', itemStyle: { color: '#2ADB5C' } },
          { value: 28, name: 'Spring', itemStyle: { color: '#18A058' } },
          { value: 35, name: 'å‰ç«¯', itemStyle: { color: '#36ad6a' } },
          { value: 22, name: 'æ•°æ®åº“', itemStyle: { color: '#0c7a43' } },
          { value: 26, name: 'ç®—æ³•', itemStyle: { color: '#4ade80' } }
        ]
      }
    ]
  }
  categoryChart.setOption(option)
}

// çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“å›¾è¡¨
const handleResize = () => {
  visitChart?.resize()
  categoryChart?.resize()
}

onMounted(() => {
  initVisitChart()
  initCategoryChart()
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  visitChart?.dispose()
  categoryChart?.dispose()
  window.removeEventListener('resize', handleResize)
})
</script>

<style scoped>
.dashboard {
  max-width: 1600px;
}

/* ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
.stats-grid {
  margin-bottom: 16px;
}

.stat-card {
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  transition: all 0.3s ease;
  background: #ffffff;
}

.stat-card:hover {
  border-color: #2ADB5C;
  box-shadow: 0 8px 24px rgba(42, 219, 92, 0.15);
  transform: translateY(-2px);
}

.stat-content {
  display: flex;
  align-items: center;
  gap: 20px;
}

.stat-icon {
  width: 70px;
  height: 70px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.card-1 .stat-icon {
  background: linear-gradient(135deg, rgba(42, 219, 92, 0.1) 0%, rgba(42, 219, 92, 0.05) 100%);
  color: #2ADB5C;
}

.card-2 .stat-icon {
  background: linear-gradient(135deg, rgba(24, 160, 88, 0.1) 0%, rgba(24, 160, 88, 0.05) 100%);
  color: #18A058;
}

.card-3 .stat-icon {
  background: linear-gradient(135deg, rgba(54, 173, 106, 0.1) 0%, rgba(54, 173, 106, 0.05) 100%);
  color: #36ad6a;
}

.card-4 .stat-icon {
  background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, rgba(74, 222, 128, 0.05) 100%);
  color: #4ade80;
}

.stat-card:hover .stat-icon {
  transform: scale(1.1) rotate(5deg);
}

.stat-info {
  flex: 1;
}

.stat-label {
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  color: #2ADB5C;
  margin-bottom: 4px;
}

.stat-trend {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: #18A058;
}

/* å›¾è¡¨å¡ç‰‡æ ·å¼ */
.chart-card {
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  background: #ffffff;
  transition: all 0.3s ease;
}

.chart-card:hover {
  border-color: #2ADB5C;
  box-shadow: 0 4px 16px rgba(42, 219, 92, 0.1);
}

/* æŠ€æœ¯æ ˆå¡ç‰‡æ ·å¼ */
.tech-card,
.changelog-card,
.system-card {
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  background: #ffffff;
  transition: all 0.3s ease;
}

.tech-card:hover,
.changelog-card:hover,
.system-card:hover {
  border-color: #2ADB5C;
  box-shadow: 0 4px 16px rgba(42, 219, 92, 0.1);
}

.tech-section {
  padding: 8px 0;
}

.tech-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #1f2937;
  margin-bottom: 12px;
}

.tech-tags {
  flex-wrap: wrap;
}

/* æ›´æ–°æ—¥å¿—æ ·å¼ */
.changelog-list {
  margin: 8px 0;
  padding-left: 20px;
  color: #6b7280;
  font-size: 13px;
  line-height: 1.8;
}

.changelog-list li {
  margin: 4px 0;
}
</style>
